# Mech-Eye_python_interface
This is official Python interface for Mech-Eye cameras. 

## Introduction

This camera interface is developped by python. We use ZeroMQ library to connect camera devices in the LANs. And Google protobuf is used to pack and unpack data from networks.

## Features 

By using this api, you can easily control your mech_eye cameras in python programs. The features of this API are as follows:

* Connect to your camera in your LANS.
* Set and get cameras parameters like exposure time, period and so on.
* Get color image and depth image as a numpy array.
* Get point cloud data as the format defined in open3d, a python lib which can deal with point clouds.

## Installation

We ran and tested this API on Python3.x. Make sure to install Python 3.x.

These python libraries are needed:

* opencv_python
* protobuf
* open3d

All these you can install with pip, by following command:

```
pip3 install opencv-python protobuf open3d
```

Then clone this repo and you are good to go.

## Quick Start

In terminal, change your working directory to the repo, and the run :

```powershell
python sample.py
```

Then a window will pop up and show point clouds. Some pictures will also be captured and stored in the same directory.

## Project hierarchy

The following shows the hierarchy of project files

```
Mech-Eye_python_interface

├─ CameraClient.py
├─ README.md
├─ ZmqClient.py
├─ protobuf
│    ├─ cameraStatus_pb2.py
│    └─ image_pb2.py
└─ sample.py
```

CameraClient.py and ZmqClient.py contains most essential codes for interfaces. 

Files in protobuf defines data structure of communications between APIs and cameras, which is  generated by Google protobuf.

## Brief Intro to interfaces

All you interfaces and functions are in  **CameraClient.py**.

There are two main classes: CameraClient and ZmqClient. CameraClient is subclass of ZmqClient. You only need to focus on CameraClient.

* **CameraClient**
  * **connect()** : connect to the camera according to its ip address.
  * **captureDepthImg()** : capture a depth image and return it.
  * **captureColorImg()** : capture a color image and return it.
  * **getCameraIntri()**: get camera's intrinsics.
  * **getCameraIp()**: get camera's ip address.
  * **getCameraVersion()**: get camera's version number.
  * **getParameter()** : get the value of a spefic parameter in camera.
  * **setParameter()** : set the value of a spefic parameter in camera.
  * **captureCloud()** : get a point cloud, open3d is used to store and process cloud data.

### Intro to samples

The original project provides a **sample.py** to show how to use APIs. 

This sample mainly shows how to set camera's paramters like exporeture time.

First, we need to know the actual ip address of camera and set it, and then connect to it:

```python
camera = CameraClient()
save_file = True
# camera ip should be modified to actual ip address
camera_ip = "192.168.3.146"
# always set ip before do anything else
if not camera.connect(camera_ip):
	exit(-1)

```

Then, we can get some brief info about camera:

```python
intri = camera.getCameraIntri()
print ("Camera IP: %s" % (camera.getCameraIp())) 
print ("Camera ID: %s" % (camera.getCameraId()))
print ("Version: %s" % (camera.getCameraVersion()))
```

We can set and get the value of a specific parameter, in this case, we choose exposure time for color image:

```c++
camera.setParameter("camera2DExpTime",15)
print(camera.getParameter("camera2DExpTime"))
camera.setParameter("camera2DExpTime",20)
print(camera.getParameter("camera2DExpTime"))
```

We can capture color images and depth images by camera. 

```python
if save_file:
    if not os.path.exists(SAVE_PATH):
        os.makedirs(SAVE_PATH)
    cv2.imwrite(SAVE_PATH + "/mechmind_depth.png", depth)
    cv2.imwrite(SAVE_PATH + "/mechmind_color.jpg", color)
```



And also point clouds will be captured. We use open3d to show the point cloud.

```python
pcd = camera.captureCloud()
open3d.visualization.draw_geometries([pcd])
```

